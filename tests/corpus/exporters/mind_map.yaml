lex: "Global"
expected: "Flat"
parse: "Full"
items:
  - name: "Single subtree"
    source: "* Subtree"
    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0", "title":"Subtree"}}
          edges:
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
  - name: "Nested subgree"
    source: |
      * LVL1
      ** LVL2
      T
    sem:
      kind: Document
      subnodes:
        - kind: Subtree
          level: 1
          title:
            subnodes:
              - {kind: BigIdent, text: LVL1}
          subnodes:
            - kind: Subtree
              level: 2
              title:
                subnodes:
                  - {kind: BigIdent, text: LVL2}
              subnodes:
                - kind: Paragraph
                  subnodes:
                    - {kind: BigIdent, text: T}
                    - {kind: Newline, text: "\n"}

    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0", "title":"LVL1"}}
            - {"metadata":{"id":"0_Subtree_1", "title":"LVL2"}}
            - {"metadata":{"id":"0_Paragraph_2","kind":"Entry"}}
          edges:
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_1","target":"0_Paragraph_2"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Subtree_0","target":"0_Subtree_1"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}

  - name: "Simple footnote"
    source: |
      * Subtree
      
      Paragraph [fn:one]

      [fn:one] Definition

    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0","title":"Subtree"}}
            - {"metadata":{"id":"0_Paragraph_1","kind":"Entry"}}
            - {"metadata":{"id":"0_Paragraph_2","kind":"Entry"}}
          edges:
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_0","target":"0_Paragraph_1"}
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_0","target":"0_Paragraph_2"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
            # Footnote in the first paragraph refers to the footnote in a different paragraph
            - {"metadata":{"kind":"RefersTo"},"source":"0_Paragraph_1","target":"0_Paragraph_2"}

  - name: "Link to subtree with ID"
    source: |
      * Target
        :properties:
        :id: target_id
        :end:

      * Source
        
        [[id:target_id]]

    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0","kind":"Subtree","title":"Target","treeId":"target_id"}}
            - {"metadata":{"id":"0_Subtree_1","kind":"Subtree","title":"Source"}}
            - {"metadata":{"id":"0_Paragraph_2","kind":"Entry"}}
          edges:
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_1","target":"0_Paragraph_2"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_1"}
            - {"metadata":{"kind":"RefersTo"},"source":"0_Paragraph_2","target":"0_Subtree_0"}
            - {"metadata":{"kind":"InternallyRefers"},"source":"0_Subtree_1","target":"0_Subtree_0"}

  - name: "Edge with description"
    source: |
      * System Registry
      ** Current input
         :properties:
         :id: sr_current_input
         :end:

      * User app

      - [[id:sr_current_input]] :: Desc
    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0","kind":"Subtree","level":1,"title":"System Registry"}}
            - {"metadata":{"id":"0_Subtree_1","kind":"Subtree","level":2,"title":"Current input","treeId":"sr_current_input"}}
            - {"metadata":{"id":"0_Subtree_2","kind":"Subtree","level":1,"title":"User app"}}
          edges:
            - {"metadata":{"kind":"NestedIn"},"source":"0_Subtree_0","target":"0_Subtree_1"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_2"}
            - source: "0_Subtree_2"
              target: "0_Subtree_1"           
              metadata:
                kind: RefersTo
                description:
                  kind: StmtList
                  subnodes: 
                    - kind: Paragraph
                      subnodes:
                        - {"kind":"Space","text":" "}
                        - {"kind":"Word","text":"Desc"}

