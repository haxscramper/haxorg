lex: "Global"
expected: "Flat"
parse: "Full"
items:
  - name: "Single subtree"
    source: "* Subtree"
    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0", "title":"Subtree"}}
          edges:
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
  - name: "Nested subgree"
    source: |
      * LVL1
      ** LVL2
      T
    sem:
      kind: Document
      subnodes:
        - kind: Subtree
          level: 1
          title:
            subnodes:
              - {kind: BigIdent, text: LVL1}
          subnodes:
            - kind: Subtree
              level: 2
              title:
                subnodes:
                  - {kind: BigIdent, text: LVL2}
              subnodes:
                - kind: Paragraph
                  subnodes:
                    - {kind: BigIdent, text: T}
                    - {kind: Newline, text: "\n"}

    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0", "title":"LVL1"}}
            - {"metadata":{"id":"0_Subtree_1", "title":"LVL2"}}
            - {"metadata":{"id":"0_Paragraph_2","kind":"Entry"}}
          edges:
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_1","target":"0_Paragraph_2"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Subtree_0","target":"0_Subtree_1"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}

  - name: "Simple footnote"
    source: |
      * Subtree
      
      Paragraph [fn:one]

      [fn:one] Definition

    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree","nested":["0_Subtree_0"]}}
            - {"metadata":{"id":"0_Subtree_0","title":"Subtree","ordered":["0_Paragraph_1"],"unordered":["0_Paragraph_2"]}}
            - {"metadata":{"id":"0_Paragraph_1","kind":"Entry"}}
            - {"metadata":{"id":"0_Paragraph_2","kind":"Entry"}}
          edges:
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_0","target":"0_Paragraph_1"}
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_0","target":"0_Paragraph_2"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
            # Footnote in the first paragraph refers to the footnote in a different paragraph
            - {"metadata":{"kind":"RefersTo"},"source":"0_Paragraph_1","target":"0_Paragraph_2"}

  - name: "Link to subtree with ID"
    source: |
      * Target
        :properties:
        :id: target_id
        :end:

      * Source
        
        [[id:target_id]] Some text

    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","nested":["0_Subtree_0","0_Subtree_1"],"kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0","kind":"Subtree","title":"Target","treeId":"target_id"}}
            - {"metadata":{"id":"0_Subtree_1","kind":"Subtree","title":"Source","ordered":["0_Paragraph_2"]}}
            - metadata:
                kind: "Entry"
                id: "0_Paragraph_2"
                order: 0 
                parent: null
                content: {
                  "kind":"Paragraph",
                  "map":{"entry":"0_Paragraph_2"},
                  "subnodes":[
                    {"data":{"Id":{"text":"target_id"},"kind":"Id","text":"target_id"},"kind":"Link","map":{"target":"0_Subtree_0"}},
                    {"kind":"Space","text":" "},
                    {"kind":"Word","text":"Some"},
                    {"kind":"Space","text":" "},
                    {"kind":"Word","text":"text"},
                    {"kind":"Newline","text":"\n"}
                  ]
                }

          edges:
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
            - {"metadata":{"kind":"PlacedIn"},"source":"0_Subtree_1","target":"0_Paragraph_2"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_1"}
            - {"metadata":{"kind":"RefersTo"},"source":"0_Paragraph_2","target":"0_Subtree_0"}
            - {"metadata":{"description":null,"kind":"InternallyRefers"},"source":"0_Subtree_1","target":"0_Subtree_0"}

  - name: "Edge with description"
    source: |
      * System Registry
      ** Current input
         :properties:
         :id: sr_current_input
         :end:

      * User app

      - [[id:sr_current_input]] :: Desc
    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","nested":["0_Subtree_0","0_Subtree_2"],"kind":"Subtree"}}
            - {"metadata":{"id":"0_Subtree_0","nested":["0_Subtree_1"],"kind":"Subtree","level":1,"title":"System Registry"}}
            - {"metadata":{"id":"0_Subtree_1","kind":"Subtree","level":2,"title":"Current input","treeId":"sr_current_input"}}
            - {"metadata":{"id":"0_Subtree_2","kind":"Subtree","level":1,"title":"User app"}}
          edges:
            - {"metadata":{"kind":"NestedIn"},"source":"0_Subtree_0","target":"0_Subtree_1"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}
            - {"metadata":{"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_2"}
            - source: "0_Subtree_2"
              target: "0_Subtree_1"           
              metadata:
                kind: RefersTo
                description:
                  kind: StmtList
                  subnodes: 
                    - kind: Paragraph
                      subnodes:
                        - {"kind":"Space","text":" "}
                        - {"kind":"Word","text":"Desc"}

  - name: "Subtree tags"
    source: "* Tree :tag:"
    exporters:
      - name: "mmap"
        expected:
          nodes:
            - {"metadata":{"id":"0_Document_0","kind":"Subtree","nested":["0_Subtree_0"]}}
            - {"metadata":{"id":"0_Subtree_0","kind":"Subtree","level":1,"tags":[{"head":"tag"}],"title":"Tree"}}
          edges:
            - {"metadata":{"description":null,"kind":"NestedIn"},"source":"0_Document_0","target":"0_Subtree_0"}

  - name: "Big mind map"
    source: |
      * Mind map nodes are made from subtrees
      ** Subtrees can be nested for clustering
        :PROPERTIES:
        :ID:       c468e9c7-7422-4b17-8ccb-53575f186fe0
        :END:

      ** More than one subtree can exist in cluster

      Tree  description, maybe  on multiple  lines.
      Can include  [[id:c468e9c7-7422-4b17-8ccb-53575f186fe0][links]] to  other trees.
      Links are attached to specific [[id:6d6d6689-d9da-418d-9f91-1c8c4428e5af][rows]] in the text
      so it is easier to track which part of the
      description refers to the [[id:9879fed7-f0a4-44bd-bf56-983279afc622][other]] tree

      - when [[id:c468e9c7-7422-4b17-8ccb-53575f186fe0][link]] :: Description lists can be used
        to create annotated links

      used in description list it's placed as annotation to the graph node.
      Description can take multiple lines[fn:lines-20].


      [fn:lines-20]  Footnotes  are placed  into  separate  nodes. You  can  have
      nested[fn:nested-23]

      [fn:nested-23] footnotes

      ** Extra entries
        :PROPERTIES:
        :ID:       6d6d6689-d9da-418d-9f91-1c8c4428e5af
        :END:

      Parent subtrees can contain some things.

      * Several clusters can exist

      Nested subtrees
      Multiline [[id:6d6d6689-d9da-418d-9f91-1c8c4428e5af][Extra entries]]

      ** With multiple nodes
        :PROPERTIES:
        :ID:       9879fed7-f0a4-44bd-bf56-983279afc622
        :END:
      ** And even nested
      *** Clusters
      *** And nodes
      *** Intercluster links are possible

      [[id:c468e9c7-7422-4b17-8ccb-53575f186fe0][Subtrees can be nested for clustering]]
    exporters:
      - name: "mmap"
        print: true
        printToFile: true
